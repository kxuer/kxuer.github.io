<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>内核驱动 | Kxuer&#39;s blog</title>
    <meta name="generator" content="VuePress 1.9.5">
    <link rel="icon" href="/img/favicon.ico">
    <meta name="description" content="计算机技术博客。前后端等技术文章。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="baidu-site-verification" content="7F55weZDDc">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/assets/css/0.styles.d9c8cf8c.css" as="style"><link rel="preload" href="/assets/js/app.152d3a4c.js" as="script"><link rel="preload" href="/assets/js/2.5c504fd0.js" as="script"><link rel="preload" href="/assets/js/80.027b548d.js" as="script"><link rel="prefetch" href="/assets/js/10.c5b2da43.js"><link rel="prefetch" href="/assets/js/100.839c8279.js"><link rel="prefetch" href="/assets/js/101.6b297eb7.js"><link rel="prefetch" href="/assets/js/102.3d503040.js"><link rel="prefetch" href="/assets/js/103.e4ff933b.js"><link rel="prefetch" href="/assets/js/104.7497c72a.js"><link rel="prefetch" href="/assets/js/105.4a297d62.js"><link rel="prefetch" href="/assets/js/106.e6238c5c.js"><link rel="prefetch" href="/assets/js/107.0ecffa58.js"><link rel="prefetch" href="/assets/js/108.064346d0.js"><link rel="prefetch" href="/assets/js/109.e1f48cc8.js"><link rel="prefetch" href="/assets/js/11.9955fd7b.js"><link rel="prefetch" href="/assets/js/110.93ce97c8.js"><link rel="prefetch" href="/assets/js/111.2ccae80b.js"><link rel="prefetch" href="/assets/js/112.810bde3a.js"><link rel="prefetch" href="/assets/js/113.09c55eeb.js"><link rel="prefetch" href="/assets/js/114.d8ff67ec.js"><link rel="prefetch" href="/assets/js/115.d2f6cc4d.js"><link rel="prefetch" href="/assets/js/116.6b4516fd.js"><link rel="prefetch" href="/assets/js/117.5205c914.js"><link rel="prefetch" href="/assets/js/118.c742187f.js"><link rel="prefetch" href="/assets/js/119.5b3c6aaf.js"><link rel="prefetch" href="/assets/js/12.929c5230.js"><link rel="prefetch" href="/assets/js/120.01db5f39.js"><link rel="prefetch" href="/assets/js/121.7f8c9a7f.js"><link rel="prefetch" href="/assets/js/122.c138cf13.js"><link rel="prefetch" href="/assets/js/123.6f7dd186.js"><link rel="prefetch" href="/assets/js/124.865f91fd.js"><link rel="prefetch" href="/assets/js/125.c991c186.js"><link rel="prefetch" href="/assets/js/126.114441af.js"><link rel="prefetch" href="/assets/js/127.9c8b7fbe.js"><link rel="prefetch" href="/assets/js/128.eefcc4f2.js"><link rel="prefetch" href="/assets/js/129.2fbf5306.js"><link rel="prefetch" href="/assets/js/13.ab65c1b2.js"><link rel="prefetch" href="/assets/js/130.1fd677e8.js"><link rel="prefetch" href="/assets/js/131.c1ed70bb.js"><link rel="prefetch" href="/assets/js/14.3023fd75.js"><link rel="prefetch" href="/assets/js/15.656e6f1d.js"><link rel="prefetch" href="/assets/js/16.e4ae5b77.js"><link rel="prefetch" href="/assets/js/17.a6423137.js"><link rel="prefetch" href="/assets/js/18.9d4bb4b0.js"><link rel="prefetch" href="/assets/js/19.0c597f5d.js"><link rel="prefetch" href="/assets/js/20.129d025d.js"><link rel="prefetch" href="/assets/js/21.e584fce1.js"><link rel="prefetch" href="/assets/js/22.063becc8.js"><link rel="prefetch" href="/assets/js/23.a3dd02b4.js"><link rel="prefetch" href="/assets/js/24.d6cb010f.js"><link rel="prefetch" href="/assets/js/25.2960c6e7.js"><link rel="prefetch" href="/assets/js/26.78626a98.js"><link rel="prefetch" href="/assets/js/27.4c6c3e26.js"><link rel="prefetch" href="/assets/js/28.aa1df5b8.js"><link rel="prefetch" href="/assets/js/29.ec046e05.js"><link rel="prefetch" href="/assets/js/3.6d361c80.js"><link rel="prefetch" href="/assets/js/30.4d6f6c19.js"><link rel="prefetch" href="/assets/js/31.4608c7b6.js"><link rel="prefetch" href="/assets/js/32.fc4a5655.js"><link rel="prefetch" href="/assets/js/33.1743ece1.js"><link rel="prefetch" href="/assets/js/34.04d7608e.js"><link rel="prefetch" href="/assets/js/35.25e80d63.js"><link rel="prefetch" href="/assets/js/36.897e2c3e.js"><link rel="prefetch" href="/assets/js/37.bf8722c8.js"><link rel="prefetch" href="/assets/js/38.18915aa1.js"><link rel="prefetch" href="/assets/js/39.a73e3b54.js"><link rel="prefetch" href="/assets/js/4.94dce7a4.js"><link rel="prefetch" href="/assets/js/40.05f7e48f.js"><link rel="prefetch" href="/assets/js/41.b1c01e89.js"><link rel="prefetch" href="/assets/js/42.6da0e530.js"><link rel="prefetch" href="/assets/js/43.637238af.js"><link rel="prefetch" href="/assets/js/44.5944e11d.js"><link rel="prefetch" href="/assets/js/45.26b483e3.js"><link rel="prefetch" href="/assets/js/46.1b30e94a.js"><link rel="prefetch" href="/assets/js/47.ad770159.js"><link rel="prefetch" href="/assets/js/48.1c845f66.js"><link rel="prefetch" href="/assets/js/49.749bca79.js"><link rel="prefetch" href="/assets/js/5.782550e2.js"><link rel="prefetch" href="/assets/js/50.6c7bbc12.js"><link rel="prefetch" href="/assets/js/51.da088c04.js"><link rel="prefetch" href="/assets/js/52.60ace533.js"><link rel="prefetch" href="/assets/js/53.b63909f5.js"><link rel="prefetch" href="/assets/js/54.db3be7b1.js"><link rel="prefetch" href="/assets/js/55.5581f0a9.js"><link rel="prefetch" href="/assets/js/56.154d842f.js"><link rel="prefetch" href="/assets/js/57.8caf7754.js"><link rel="prefetch" href="/assets/js/58.bc7c5c68.js"><link rel="prefetch" href="/assets/js/59.f1212943.js"><link rel="prefetch" href="/assets/js/6.7aacd47c.js"><link rel="prefetch" href="/assets/js/60.69b32384.js"><link rel="prefetch" href="/assets/js/61.93b2cfef.js"><link rel="prefetch" href="/assets/js/62.8c87418a.js"><link rel="prefetch" href="/assets/js/63.dcaf5fe0.js"><link rel="prefetch" href="/assets/js/64.44457f77.js"><link rel="prefetch" href="/assets/js/65.02a5e697.js"><link rel="prefetch" href="/assets/js/66.7f463250.js"><link rel="prefetch" href="/assets/js/67.0e4d3b60.js"><link rel="prefetch" href="/assets/js/68.cffb5314.js"><link rel="prefetch" href="/assets/js/69.a0b44aba.js"><link rel="prefetch" href="/assets/js/7.0860eea1.js"><link rel="prefetch" href="/assets/js/70.944df57e.js"><link rel="prefetch" href="/assets/js/71.73da8d16.js"><link rel="prefetch" href="/assets/js/72.b1290ec0.js"><link rel="prefetch" href="/assets/js/73.9a4d586a.js"><link rel="prefetch" href="/assets/js/74.e8a08be7.js"><link rel="prefetch" href="/assets/js/75.42fa9f6e.js"><link rel="prefetch" href="/assets/js/76.3e8fabaa.js"><link rel="prefetch" href="/assets/js/77.52671e74.js"><link rel="prefetch" href="/assets/js/78.02d54f7f.js"><link rel="prefetch" href="/assets/js/79.184a00f0.js"><link rel="prefetch" href="/assets/js/8.fea18674.js"><link rel="prefetch" href="/assets/js/81.67faaf37.js"><link rel="prefetch" href="/assets/js/82.96eac408.js"><link rel="prefetch" href="/assets/js/83.79e495af.js"><link rel="prefetch" href="/assets/js/84.ee74eb85.js"><link rel="prefetch" href="/assets/js/85.a880f4eb.js"><link rel="prefetch" href="/assets/js/86.6a266a22.js"><link rel="prefetch" href="/assets/js/87.727a287b.js"><link rel="prefetch" href="/assets/js/88.81cb348a.js"><link rel="prefetch" href="/assets/js/89.e979df06.js"><link rel="prefetch" href="/assets/js/9.95374233.js"><link rel="prefetch" href="/assets/js/90.1e627d78.js"><link rel="prefetch" href="/assets/js/91.467a13ab.js"><link rel="prefetch" href="/assets/js/92.fd6425af.js"><link rel="prefetch" href="/assets/js/93.bab60ba3.js"><link rel="prefetch" href="/assets/js/94.07efa254.js"><link rel="prefetch" href="/assets/js/95.7d9d761d.js"><link rel="prefetch" href="/assets/js/96.e83ad60d.js"><link rel="prefetch" href="/assets/js/97.c9d2f939.js"><link rel="prefetch" href="/assets/js/98.f538657e.js"><link rel="prefetch" href="/assets/js/99.f43a2f34.js">
    <link rel="stylesheet" href="/assets/css/0.styles.d9c8cf8c.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/img/logo.png" alt="Kxuer's blog" class="logo"> <span class="site-name can-hide">Kxuer's blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/frontend/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/frontend/js/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link">VUE</a></li><li class="dropdown-item"><!----> <a href="/frontend/browser/" class="nav-link">浏览器</a></li><li class="dropdown-item"><!----> <a href="/frontend/es6/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/frontend/framework/" class="nav-link">框架</a></li><li class="dropdown-item"><!----> <a href="/frontend/others/" class="nav-link">他人文章</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/backend/go/" class="nav-link">Golang</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/technology/tech/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/technology/blog/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/technology/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/technology/embedded-linux/" class="nav-link">嵌入式Linux</a></li><li class="dropdown-item"><!----> <a href="/technology/database/" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/technology/software/" class="nav-link">软件使用</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/kxuer/kxuer.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><div class="blogger"><img src="https://cdn.staticaly.com/gh/kxuer/image_store@main/img/knowledge.6zl141tmhs80.webp"> <div class="blogger-info"><h3>Kxuer Z</h3> <span>前端界的小学生</span></div></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">首页</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="前端" class="dropdown-title"><a href="/frontend/" class="link-title">前端</a> <span class="title" style="display:none;">前端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/frontend/html/" class="nav-link">HTML</a></li><li class="dropdown-item"><!----> <a href="/frontend/css/" class="nav-link">CSS</a></li><li class="dropdown-item"><!----> <a href="/frontend/js/" class="nav-link">JavaScript</a></li><li class="dropdown-item"><!----> <a href="/frontend/vue/" class="nav-link">VUE</a></li><li class="dropdown-item"><!----> <a href="/frontend/browser/" class="nav-link">浏览器</a></li><li class="dropdown-item"><!----> <a href="/frontend/es6/" class="nav-link">ES6</a></li><li class="dropdown-item"><!----> <a href="/frontend/framework/" class="nav-link">框架</a></li><li class="dropdown-item"><!----> <a href="/frontend/others/" class="nav-link">他人文章</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="后端" class="dropdown-title"><a href="/backend/" class="link-title">后端</a> <span class="title" style="display:none;">后端</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/backend/java/" class="nav-link">Java</a></li><li class="dropdown-item"><!----> <a href="/backend/go/" class="nav-link">Golang</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="技术" class="dropdown-title"><a href="/technology/" class="link-title">技术</a> <span class="title" style="display:none;">技术</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/technology/tech/" class="nav-link">技术文档</a></li><li class="dropdown-item"><!----> <a href="/technology/blog/" class="nav-link">博客搭建</a></li><li class="dropdown-item"><!----> <a href="/technology/linux/" class="nav-link">Linux</a></li><li class="dropdown-item"><!----> <a href="/technology/embedded-linux/" class="nav-link">嵌入式Linux</a></li><li class="dropdown-item"><!----> <a href="/technology/database/" class="nav-link">数据库</a></li><li class="dropdown-item"><!----> <a href="/technology/software/" class="nav-link">软件使用</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="更多" class="dropdown-title"><a href="/more/" class="link-title">更多</a> <span class="title" style="display:none;">更多</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/pages/f2a556/" class="nav-link">学习</a></li><li class="dropdown-item"><!----> <a href="/pages/aea6571b7a8bae86/" class="nav-link">面试</a></li><li class="dropdown-item"><!----> <a href="/pages/2d615df9a36a98ed/" class="nav-link">心情杂货</a></li><li class="dropdown-item"><!----> <a href="/pages/baaa02/" class="nav-link">实用技巧</a></li><li class="dropdown-item"><!----> <a href="/friends/" class="nav-link">友情链接</a></li></ul></div></div><div class="nav-item"><a href="/about/" class="nav-link">关于</a></div><div class="nav-item"><a href="/pages/beb6c0bd8a66cea6/" class="nav-link">收藏</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/kxuer/kxuer.github.io" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>技术文档</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>博客搭建</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Linux</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>嵌入式Linux</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/pages/725391/" class="sidebar-link">嵌入式Linux概述</a></li><li><a href="/pages/59b6a0/" class="sidebar-link">交叉编译工具链（cross-compiling toolchains）</a></li><li><a href="/pages/8deda9/" class="sidebar-link">BIOS or bootloader</a></li><li><a href="/pages/31debf/" class="sidebar-link">Linux内核</a></li><li><a href="/pages/5c591b/" class="sidebar-link">Linux根文件系统</a></li><li><a href="/pages/e1716e/" aria-current="page" class="active sidebar-link">内核驱动</a></li><li><a href="/pages/996c72/" class="sidebar-link">块文件系统</a></li><li><a href="/pages/2da79d/" class="sidebar-link">交叉编译用户空间库和应用程序</a></li><li><a href="/pages/fb270d/" class="sidebar-link">嵌入式Linux软件栈概览</a></li><li><a href="/pages/1f78e3/" class="sidebar-link">嵌入式Linux应用开发</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>数据库</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>密码学</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Windows</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>软件使用</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/technology/#技术" data-v-06225672>技术</a></li><li data-v-06225672><a href="/technology/#嵌入式Linux" data-v-06225672>嵌入式Linux</a></li></ul> <div class="info" data-v-06225672><div title="作者" class="author iconfont icon-touxiang" data-v-06225672><a href="https://github.com/kxuer" target="_blank" title="作者" class="beLink" data-v-06225672>kxuer</a></div> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2023-03-31</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><!----> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">内核驱动<!----></h1>  <div class="theme-vdoing-content content__default"><p>访问硬件的过程：![[Pasted image 20230303095242.png]]</p> <ul><li>内核中的总线控制器驱动 驱动 I2C, SPI, USB, PCI控制器。</li> <li>总线子系统为设备驱动提供了访问某种类型总线（I2C, SPI, PCI, USB等等）的API。</li> <li>设备驱动 驱动 连接到某个总线的某个设备。</li> <li>驱动子系统通过kernel/user-space接口对外提供访问设备的方法。</li> <li>应用程序通过kernel/user-space接口或库访问设备。
示例：GPIO扩展器![[Pasted image 20230303100540.png]]</li></ul> <p>kernel/user-space接口：</p> <ul><li>同类型的设备（如GPIO控制器）暴露的是统一的kernel/user-space接口。</li> <li>用户空间程序不必知道GPIO控制器的细节，只需关心接口是否合法即可。</li> <li>有些可用的开源库封装了这些kernel/user-space接口，用户空间程序使用库的接口即可。
用于设备的内核子系统：</li> <li>用于以太网、WiFi、CAN、802.15.4的网络协议栈。</li> <li>GPIO。</li> <li>用于摄像机、视频编解码的Video4Linux。</li> <li>用于图形控制器、GPU的DRM。</li> <li>用于音频的ALSA。</li> <li>用于ADC, DAC，陀螺仪，传感器等设备的IIO。</li> <li>用于闪存的MTD。</li> <li>PWM。</li> <li>用于键盘、鼠标、触摸屏、操纵杆的输入系统。</li> <li>看门狗。</li> <li>用于实时时钟的RTC。</li> <li>用于辅助处理器的remoteproc。</li> <li>用于密码加速器的crypto。</li> <li>用于硬件监控的hwmon。</li> <li>用于块存储设备的block layer。</li> <li>......</li></ul> <blockquote><p>从用户空间之间访问设备：最好通过位于内核的设备驱动访问设备，但是可能有些设备并不适配到任何已存在的内核子系统。根据总线不同，内核提供了以下机制：</p> <ul><li>I2C: <a href="https://docs.kernel.org/i2c/dev-interface.html" target="_blank" rel="noopener noreferrer">i2c-dev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>SPI: <a href="https://docs.kernel.org/spi/spidev.html" target="_blank" rel="noopener noreferrer">spidev<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>内存映射：<a href="https://docs.kernel.org/driver-api/uio-howto.html" target="_blank" rel="noopener noreferrer">UIO<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>USB: /dev/bus/usb, 通过 <a href="https://libusb.info/" target="_blank" rel="noopener noreferrer">libusb<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>PCI: <a href="https://docs.kernel.org/PCI/sysfs-pci.html" target="_blank" rel="noopener noreferrer">sysfs entries for PC<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>
示例：GPIO![[Pasted image 20230303223656.png]]</li></ul> <p>如果写的是用户空间驱动而不是内核驱动，有什么问题？</p> <ul><li>其他内核驱动无法使用你写的用户空间驱动，导致无法正常工作。</li></ul> <p>Upstream drivers vs. out-of-tree drivers</p> <ul><li>简单理解：Upstream drivers指内核官方认可的驱动，out-of-tree drivers是设备厂商提供的驱动。</li></ul> <p>如何查找内核驱动：</p> <ul><li>grep：如果是I2C、 SPI、内核映射设备，则根据设备名或厂商搜索；如果是USB、PCI，则根据厂商ID、产品ID搜索。</li> <li>注意：驱动文件名不仅仅反应支持一个设备，而可能是某一类设备。</li> <li>示例：查找在I2C总线上的Maxim Integrated MAX7313 GPIO控制器的驱动
<ul><li>git grep -i max7313</li> <li>查看drivers/gpio/Makefile哪个内核选项启动该驱动</li></ul></li></ul></blockquote> <p>用于硬件设备的用户空间接口：</p> <ul><li>从上层角度看，内核暴露的用于访问硬件设备的三种接口：  ^5db532
<ol><li>/dev目录下的设备节点。
<ul><li>主要分为：
<ul><li>字符设备：无限制的字节流。用于串口、终端、声卡、视频获取设备、帧缓冲等等。</li> <li>块设备：用固定大小的块来读写数据。用于硬盘、USB设备、SD卡等等。</li></ul></li> <li>标识方法：Type（字符设备或块设备）+Major（通常为设备类别）+Minor（通常为设备ID）。<a href="https://elixir.bootlin.com/linux/latest/source/Documentation/admin-guide/devices.txt" target="_blank" rel="noopener noreferrer">官方保留、不可用的数字<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>抽象：每个设备都是一个文件，可通过文件API操作。</li> <li>如何创建设备文件：
<ul><li>Linux 2.6.32之前：<code>mknod /dev/&lt;device&gt; [c|b] major minor</code></li> <li>将devtmpfs虚拟文件系统挂载到/dev目录下 → 内核自动创建和删除设备文件。使用CONFIG_DEVTMPFS_MOUNT设置内核在启动时挂载devtmpfs虚拟文件系统（使用initramfs时不可用）。该方式还不够强大，可使用udev和mdev作为补充。</li> <li>udev：一个从内核接收有关设备出现/消失事件的damon程序。
<ul><li>可以创建/删除设备文件（现在通常由devtmpfs做这事），修改权限、所属关系，[[06 内核驱动#^886d86]]自动加载内核模块，创建到设备的符号链接。根据/lib/udev/rules.d 和 /etc/udev/rules.d中的规则文件执行。</li></ul></li> <li>mdev：Busybox实现的轻量级udev。</li></ul></li> <li>示例：
<ul><li>串口：/dev/ttyS*, /dev/ttyUSB*, /dev/ttyACM*, etc.</li> <li>GPIO控制器：/dev/gpiochipX。</li> <li>块存储设备：/dev/sd*, /dev/mmcblk*, /dev/nvme*</li> <li>闪存设备：/dev/mtd*</li> <li>显示设备和GPU：/dev/dri/*</li> <li>声音设备：/dev/snd/*</li> <li>摄像机设备：/dev/video*</li> <li>看门狗设备：/dev/watchdog*</li> <li>输入设备：/dev/input/*</li></ul></li></ul></li> <li>sysfs文件系统中的项。
<ul><li>block/：symlinks到/sys/devices中的块设备。</li> <li>bus/：每种总线都有各自一个子文件夹。
<ul><li>例/sys/bus/i2c/drivers：连接到I2C总线的设备的设备驱动。</li> <li>例/sys/bus/i2c/devices：连接到I2C总线的所有设备。</li></ul></li> <li>class/：每种类别的设备都有各自一个子文件夹，如input, leds, pwm, etc.</li> <li>dev/：
<ul><li>block/：每个块设备的symlink, named after major/minor。</li> <li>char/：每个字符设备的symlink, named after major/minor。</li></ul></li> <li>devices/：系统中的所有设备，看<a href="https://lwn.net/Articles/646617/" target="_blank" rel="noopener noreferrer">这个<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>firmware/：固件数据。
<ul><li>devicetree/：设备树节点和属性。</li></ul></li> <li>fs/：与文件系统驱动相关的属性。</li> <li>kernel/：与内核子系统相关的属性。</li> <li>module/：与内核模块相关的属性。</li> <li>power/：与电源管理相关的属性。</li></ul></li></ol></li></ul> <blockquote><p>注：所有的设备都可在sysfs中能看到，不管它们是否在/dev有接口。</p> <ul><li>通常用/dev访问设备。</li> <li>/sys更多的是用来查看设备的属性。</li> <li>有些设备只在/sys出现：
<ul><li>• LED: /sys/class/leds</li> <li>• PWM: /sys/class/pwm</li> <li>• IIO: /sys/class/iio
GPIO (General Purpose Input Output)：</li> <li>以前用/sys/class/gpios接口访问。</li> <li>现在用<a href="https://git.kernel.org/pub/scm/libs/libgpiod/libgpiod.git/" target="_blank" rel="noopener noreferrer">libgpiod<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>：
<ul><li>其基于/dev/gpiochipx字符设备。</li> <li>是个C语言库。也提供了命令行工具：gpiodetect, gpioset, gpioget...
其他的虚拟文件系统：</li></ul></li> <li>debugfs：挂载在/sys/kernel/debug，包含许多来自内核的debug信息（包括设备相关的）；/sys/kernel/debug/pinctrl是pin多路复用的debug信息，/sys/kernel/debug/gpio是GPIO的debug信息，/sys/kernel/debug/pwm是PWM的debug信息。</li> <li>configfs：挂载在/sys/kernel/config，用来内核高级机制的配置管理，如USB gadget的配置。</li></ul></li></ul></blockquote> <ol start="3"><li>网络套接字及相关API。</li></ol> <p>使用内核模块：</p> <ul><li>为什么要用模块：保证内核镜像最小化，模块只有在检测到硬件时才按需加载；方便驱动开发；减少启动时间。![[Pasted image 20230304174340.png]]</li> <li>模块安装：
<ul><li>在<code>/lib/modules/&lt;kernel-version&gt;/</code>目录下。</li> <li>编译后的内核模块存储在.ko文件。</li> <li>元数据文件：
<ul><li>modules.dep模块依赖：模块加载工具会使用这些信息加载模块。</li> <li>modules.alias<strong>模块别名</strong>：设备属性映射模块名，方便查找模块名。![[Pasted image 20230304175704.png]] ^886d86</li> <li>modules.symbols，modules.builtin。</li></ul></li> <li>每个文件都有对应的.bin文件，它是文本文件的优化版本。</li></ul></li> <li>模块工具：
<ul><li>modinfo：<code>modinfo &lt;module_name&gt;</code>显示/lib/modules目录下模块的信息；或<code>modinfo /path/to/module.ko</code></li> <li>lsmod：显示当前已加载的内核模块，是通过/proc/modules获取的信息。</li> <li>insmod、rmmod：加载、卸载模块，必须使用完整路径名，并不会处理模块依赖。</li> <li>modprobe：加载、卸载模块，使用模块名作为参数即可，使用modules.dep文件自动处理模块依赖，<code>modprobe -r &lt;module_name&gt;</code>卸载模块时还可以把没有被用到的依赖模块一并卸载。</li> <li>模块配置参数：
<ul><li>安装模块时设置：insmod ./usb-storage.ko delay_use=0</li> <li>使用配置文件：/etc/modprobe.conf文件或/etc/modprobe.d/目录下的文件，例<code>options usb-storage delay_use=0</code>。</li> <li>当模块内建到内核中时，也可以使用内核命令行：usb-storage.delay_use=0</li></ul></li></ul></li> <li>sysfs文件系统中的模块信息：<code>/sys/module/&lt;module_name&gt;</code> <ul><li>（个人理解）包含当前系统已加载的模块信息。</li> <li>甚至可以在运行时改变模块参数（取决于模块代码）：<code>echo 0 &gt; /sys/module/usb_storage/parameters/delay_use</code></li></ul></li></ul> <p>描述不可发现的硬件：<strong>设备树</strong></p> <ul><li>描述不可发现的硬件的方法：
<ul><li>直接在OS/bootloader代码中：使用编译好的数据结构，可维护性较差。</li> <li>使用ACPI表：多用在x86平台，有些ARM64平台也用；表由固件提供。</li> <li>使用设备树：起源于由Sun设计、用于SPARC和PowerPC的OpenFirmware。目前主要用在嵌入式设备。</li></ul></li> <li>设备树源文件（树形数据结构）经过设备树编译器编译后生成Device Tree Blob。
<ul><li>DTB加载到内存后也叫FDT, Flattened Device Tree</li> <li>U-Boot中：使用fdt命令。</li> <li>fdt_ APIs。</li></ul></li> <li>使用blob：
<ul><li>可以在bootloader中被直接链接。</li> <li><code>boot[z,i,m] &lt;kernel-addr&gt; - &lt;dtb-addr&gt;</code>![[Pasted image 20230304214010.png]]</li> <li>可以使用libfdt库解析blob。</li></ul></li> <li>设备树源文件：
<ul><li>位于内核源码<code>arch/&lt;ARCH&gt;/boot/dts</code>，Linux 6.0中大概由4500个.dts 和 .dtsi文件。</li> <li>这些文件也被复制到其他项目，如U-Boot, Barebox, TF-A中。</li></ul></li> <li>设备树基本语法：![[Pasted image 20230304215152.png]]
<ul><li>树由节点组成，节点≈一个设备或IP块。</li> <li>节点包含属性，属性≈设备特征。
<ul><li>compatible：值为字符串列表，从特殊到一般。![[Pasted image 20230305165644.png]]
<ul><li>唯一指定了设备的编程模型。</li> <li>通常被操作系统用来查找适合设备的驱动。
<ul><li>平台设备（platform devices）：顶层设备树节点、simple-bus的子节点。在内核启动时，会自动初始化平台设备。</li> <li>每个Linux驱动都有一张其支持的compatible strings的列表：<code>struct of_device_id[]</code><a href="https://elixir.bootlin.com/linux/latest/ident/of_device_id" target="_blank" rel="noopener noreferrer">of_device_id<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li> <li>当一个设备树节点的compatible string匹配某个驱动时，设备将被绑定到该驱动上。</li> <li>![[Pasted image 20230305165810.png]]</li></ul></li> <li>每个字符串的格式为：“vendor,model”</li> <li>特殊值：simple-bus → 所有子节点都是内存映射（memory-mapped）设备的总线。</li></ul></li> <li>reg：
<ul><li>如果是内存映射设备：每个项为内存映射寄存器的基物理地址,大小。</li> <li>如果是I2C设备：值为设备在I2C总线上的地址。</li> <li>如果是SPI设备：值为芯片选择数。</li> <li>The unit address must be the address of the first reg entry.</li></ul></li> <li>status：描述设备是否被使用。</li></ul></li> <li>phandle：指向其他节点。</li></ul></li> <li>设备树示例：![[Pasted image 20230304220529.png]]</li></ul> <div class="language-dts line-numbers-mode"><pre class="language-text"><code>/ {
    #address-cells = &lt;1&gt;;
    #size-cells = &lt;1&gt;;
    model = &quot;STMicroelectronics STM32MP157C-DK2 Discovery Board&quot;;
    compatible = &quot;st,stm32mp157c-dk2&quot;, &quot;st,stm32mp157&quot;;

    cpus {  #CPU核心
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;0&gt;;
        cpu0: cpu@0 {
	        compatible = &quot;arm,cortex-a7&quot;;
	        clock-frequency = &lt;650000000&gt;;
	        device_type = &quot;cpu&quot;;
	        reg = &lt;0&gt;;
        };

        cpu1: cpu@1 {
	        compatible = &quot;arm,cortex-a7&quot;;
	        clock-frequency = &lt;650000000&gt;;
	        device_type = &quot;cpu&quot;;
	        reg = &lt;1&gt;;
        };
    };

    memory@0 {  #内存
        device_type = &quot;memory&quot;;
        reg = &lt;0x0 0x20000000&gt;;
    };

    chosen {
        bootargs = &quot;&quot;;
        stdout-path = &quot;serial0:115200n8&quot;;
    };

    intc: interrupt-controller@a0021000 {   #GIC中断控制器
        compatible = &quot;arm,cortex-a7-gic&quot;;
        #interrupt-cells = &lt;3&gt;;
        interrupt-controller;
        reg = &lt;0xa0021000 0x1000&gt;,
        &lt;0xa0022000 0x2000&gt;;
    };

    soc {
        compatible = &quot;simple-bus&quot;;
        #address-cells = &lt;1&gt;;
        #size-cells = &lt;1&gt;;
        interrupt-parent = &lt;&amp;intc&gt;; # 中断控制的父控制  

        i2c1: i2c@40012000 {    #I2C控制器
            compatible = &quot;st,stm32mp15-i2c&quot;;
            reg = &lt;0x40012000 0x400&gt;;
            interrupts = &lt;GIC_SPI 31 IRQ_TYPE_LEVEL_HIGH&gt;,
			             &lt;GIC_SPI 32 IRQ_TYPE_LEVEL_HIGH&gt;;
            #address-cells = &lt;1&gt;;
            #size-cells = &lt;0&gt;;
            status = &quot;okay&quot;;  

            cs42l51: cs42l51@4a {   #音频解码器
                compatible = &quot;cirrus,cs42l51&quot;;
                reg = &lt;0x4a&gt;;
                reset-gpios = &lt;&amp;gpiog 9 GPIO_ACTIVE_LOW&gt;;
                status = &quot;okay&quot;;
            };
        };

        ethernet0: ethernet@5800a000 {  #以太网
            compatible = &quot;st,stm32mp1-dwmac&quot;, &quot;snps,dwmac-4.20a&quot;;
            reg = &lt;0x5800a000 0x2000&gt;;
            interrupts-extended = &lt;&amp;intc GIC_SPI 61 IRQ_TYPE_LEVEL_HIGH&gt;;
            status = &quot;okay&quot;;

            mdio0 {
                #address-cells = &lt;1&gt;;
                #size-cells = &lt;0&gt;;
                compatible = &quot;snps,dwmac-mdio&quot;;
                phy0: ethernet-phy@0 {
                    reg = &lt;0&gt;;
                };
            };            
        };
    };
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br></div></div><ul><li>设备树继承：
<ul><li>.dtsi是被包含的文件：通常包含SoC级别的定义信息、对多个开发板都公用的定义信息。</li> <li>.dts是最终的设备树文件：通常包含开发板级别的定义信息。</li> <li>通过堆叠（overlaying）方式工作。</li> <li>示例：STM32MP1![[Pasted image 20230305142446.png]]</li></ul></li> <li>设备树设计原则：
<ul><li>用于描述，而不是配置。</li> <li>与操作系统无关：无论是U-Boot, FreeBSD或者Linux。且升级系统时不用更改设备树。</li> <li>描述的是设备组件的集成，而不是设备组件的内部构造：设备树描述设备是如何连接/集成（如通过IRQ总线、DMA通道、时钟、重置线等等）到系统的其他部分，而设备如何工作是由设备驱动中的代码决定的。</li></ul></li> <li>设备树规范：<a href="https://www.devicetree.org/specifications/" target="_blank" rel="noopener noreferrer">specifications<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> <ul><li><a href="https://elixir.bootlin.com/linux/latest/source/Documentation/devicetree/bindings/" target="_blank" rel="noopener noreferrer">Device Tree Bindings<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> → 关于设备的每一部分是如何描述的文档。
<ul><li>以前是human readable文档。</li> <li>现在使用YAML格式的文档。</li></ul></li></ul></li> <li>校验设备树：
<ul><li>dtc只做语法校验。</li> <li>校验YAML bindings：make dt_binding_check</li> <li>校验当前启用的设备树是否与YAML bindings一致：make dtbs_check</li> <li>校验YAML binding指定的设备树：make DT_SCHEMA_FILES=Documentation/devicetree/bindings/trivialdevices.yaml dtbs_check</li></ul></li> <li>把这些描述为资源：interrupts, clocks, DMA, reset lines, ...
<ul><li>pin多路复用：使用pinmux控制器，设备树描述哪些配置可用、根据pin的状态设置设备使用的配置（pinctrl-X）。![[Pasted image 20230305173225.png]]</li></ul></li> <li>示例：LED和I2C设备
<ul><li>创建arch/arm/boot/dts/stm32mp157a-dk1-custom.dts：</li></ul> <div class="language-dts line-numbers-mode"><pre class="language-text"><code>#include &quot;stm32mp157a-dk1.dts&quot; 
/ { 
    leds { //描述LED
   	 compatible = &quot;gpio-leds&quot;; 
   	 webinar { 
   		 label = &quot;webinar&quot;; 
   		 gpios = &lt;&amp;gpioe 1 GPIO_ACTIVE_HIGH&gt;; 
   	}; 
   }; 
   &amp;i2c5 { //连接I2C温度、湿度、压力传感器
   	status = &quot;okay&quot;; 
   	clock-frequency = &lt;100000&gt;; 
   	pinctrl-names = &quot;default&quot;, &quot;sleep&quot;; 
   	pinctrl-0 = &lt;&amp;i2c5_pins_a&gt;; 
   	pinctrl-1 = &lt;&amp;i2c5_pins_sleep_a&gt;; 
   	pressure@76 { 
   		compatible = &quot;bosch,bme280&quot;; 
   		reg = &lt;0x76&gt;; 
   	}; 
   };
};
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><ul><li>修改arch/arm/boot/dts/Makefile使stm32mp157a-dk1-custom.dts编译到一个DTB。</li> <li>制作dtbs：DTC arch/arm/boot/dts/stm32mp157a-dk1-custom.dtb</li></ul> <div class="language-sh line-numbers-mode"><pre class="language-sh"><code><span class="token builtin class-name">echo</span> <span class="token number">255</span> <span class="token operator">&gt;</span> /sys/class/leds/webinar/brightness   <span class="token comment">#让led亮起来</span>
<span class="token function">cat</span> /sys/bus/iio/devices/iio<span class="token punctuation">\</span>:device2/in_humidityrelative_input  <span class="token comment">#读取湿度值</span>
<span class="token function">cat</span> /sys/bus/iio/devices/iio<span class="token punctuation">\</span>:device2/in_pressure_input   <span class="token comment">#读取压力值</span>
<span class="token function">cat</span> /sys/bus/iio/devices/iio<span class="token punctuation">\</span>:device2/in_temp_input   <span class="token comment">#读取温度值</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li></ul> <p>可发现的设备：USB和PCI</p> <ul><li>一些总线有内建的硬件发现机制，主要是USB和PCI总线。
<ul><li>总线上的硬件设备可被枚举，设备特性也可通过驱动或总线控制器获得。</li> <li>lsusb，lspci：列举检测到的设备，但能被检测到并不意味着存在设备对应的内核驱动。</li> <li>如何关联内核驱动：通常根据设备ID、厂商ID，或者根据设备类型、子类型等设备特性。</li></ul></li></ul></div></div>  <div class="page-edit"><div class="edit-link"><a href="https://github.com/kxuer/kxuer.github.io/edit/master/docs/03.技术/04.嵌入式Linux/06.内核驱动.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2023/03/31, 09:44:53</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><a href="/pages/5c591b/" class="page-nav-centre page-nav-centre-prev"><div class="tooltip">Linux根文件系统</div></a> <a href="/pages/996c72/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">块文件系统</div></a></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/pages/5c591b/" class="prev">Linux根文件系统</a></span> <span class="next"><a href="/pages/996c72/">块文件系统</a>→
      </span></p></div></div></div> <div class="article-list"><div class="article-title"><a href="/archives/" class="iconfont icon-bi">最近更新</a></div> <div class="article-wrapper"><dl><dd>01</dd> <dt><a href="/pages/1f78e3/"><div>
            嵌入式Linux应用开发
            <!----></div></a> <span class="date">03-31</span></dt></dl><dl><dd>02</dd> <dt><a href="/pages/fb270d/"><div>
            嵌入式Linux软件栈概览
            <!----></div></a> <span class="date">03-31</span></dt></dl><dl><dd>03</dd> <dt><a href="/pages/2da79d/"><div>
            交叉编译用户空间库和应用程序
            <!----></div></a> <span class="date">03-31</span></dt></dl> <dl><dd></dd> <dt><a href="/archives/" class="more">更多文章&gt;</a></dt></dl></div></div></main></div> <div class="footer"><div class="icons"><a href="mailto:xuerk@outlook.com" title="发邮件" target="_blank" class="iconfont icon-youjian"></a><a href="https://github.com/kxuer" title="GitHub" target="_blank" class="iconfont icon-github"></a></div> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2022-2023
    <span>Kxuer Z | <a href="https://github.com/xugaoyi/vuepress-theme-vdoing/blob/master/LICENSE" target="_blank">MIT License</a></span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"><div></div></div></div>
    <script src="/assets/js/app.152d3a4c.js" defer></script><script src="/assets/js/2.5c504fd0.js" defer></script><script src="/assets/js/80.027b548d.js" defer></script>
  </body>
</html>
